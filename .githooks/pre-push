#!/bin/sh
# Block pushes to main, but allow tag pushes.

blocked=0

while read -r local_ref local_sha remote_ref remote_sha; do
  if [ "$remote_ref" = "refs/heads/main" ]; then
    blocked=1
    break
  fi
done

if [ "$blocked" -eq 1 ]; then
  echo "ERROR: Direct pushes to main are blocked. Create a feature branch first." >&2
  exit 1
fi
